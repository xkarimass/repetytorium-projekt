<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Szczegóły</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #111 0%, #000 70%);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.card {
  display: flex;
  background: #1a1a1a;
  border-radius: 20px;
  overflow: hidden;
  width: 1000px;
  max-width: 95%;
  box-shadow: 0 0 60px rgba(255, 0, 0, 0.4);
  transition: 0.3s ease;
}

.card:hover {
  transform: scale(1.01);
}

.card img {
  width: 400px;
  object-fit: cover;
}

.info {
  padding: 40px;
  flex: 1;
}

.info h1 {
  color: #ff3c3c;
  margin-top: 0;
  font-size: 32px;
}

.rating-container {
  margin: 15px 0 25px 0;
}

.stars {
  font-size: 26px;
  cursor: pointer;
  letter-spacing: 3px;
}

.star {
  transition: 0.2s ease;
}

.star:hover {
  transform: scale(1.2);
}

.stars .filled {
  color: #ff3c3c;
}

#averageRating {
  font-weight: bold;
  font-size: 18px;
  color: #ff3c3c;
}

#voteCount {
  font-size: 13px;
  color: #aaa;
}

.info p {
  margin: 6px 0;
  font-size: 15px;
}

button {
  margin-top: 30px;
  padding: 12px 25px;
  background: #ff3c3c;
  border: none;
  color: white;
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.3s;
}

button:hover {
  background: #ff0000;
  transform: scale(1.05);
}
</style>
</head>
<body>

<div class="card">
  <img id="cover">
  <div class="info">
    <h1 id="title"></h1>

    <div class="rating-container">
      <div id="averageRating">0 / 10</div>
      <div id="voteCount">0 głosów</div>
      <div class="stars">
        <span class="star" data-value="1">☆</span>
        <span class="star" data-value="2">☆</span>
        <span class="star" data-value="3">☆</span>
        <span class="star" data-value="4">☆</span>
        <span class="star" data-value="5">☆</span>
        <span class="star" data-value="6">☆</span>
        <span class="star" data-value="7">☆</span>
        <span class="star" data-value="8">☆</span>
        <span class="star" data-value="9">☆</span>
        <span class="star" data-value="10">☆</span>
      </div>
    </div>

    <p id="type"></p>
    <p id="description"></p>
    <div id="extraDetails"></div>
    <button onclick="window.history.back()">⬅ Wróć</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSA7M0IwPlj4wEWdENQUnstPuEtBMYAz8",
  authDomain: "projekt-da6f3.firebaseapp.com",
  projectId: "projekt-da6f3",
  storageBucket: "projekt-da6f3.firebasestorage.app",
  messagingSenderId: "139807931879",
  appId: "1:139807931879:web:3758409524b9e1cefe1142",
  measurementId: "G-K049858GR0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let items = [
  { title: "Attack on Titan", type: "anime", description: "Ludzkość walczy z Tytanami...", image: "aot.jpg", genre: "Akcja, Dramat", episodes: 87, episodeLength: "24 min", status: "Zakończone", startDate: "2013-04-07", endDate: "2023-11-05"},
  { title: "Death Note", type: "anime", description: "Młody chłopak znajduje notes śmierci...", image: "DN.jpg", genre: "Thriller, Psychologiczne", episodes: 37, episodeLength: "23 min", status: "Zakończone", startDate: "2006-10-03", endDate: "2007-06-26"},
  { title: "The Witcher 3", type: "game", description: "Przygody Geralta z Rivii...", image: "wiedzmin3.jpg", genre: "RPG, Fantasy", releaseYear: "2015", studio: "CD Projekt Red", platform: "PC, PS4, Xbox One"},
  { title: "Red Dead Redemption 2", type: "game", description: "Przygoda w otwartym świecie Dzikiego Zachodu", image: "rdr2.jpg", genre: "Akcja, RPG", releaseYear: "2018", studio: "Rockstar Games", platform: "PC, PS4, Xbox One"},
  { title: "Naruto", type: "anime", description: "Historia młodego ninja z wioski Liścia", image: "naruto.jpg", genre: "Akcja, Przygodowe", episodes: 220, episodeLength: "23 min", status: "Zakończone", startDate: "2002-10-03", endDate: "2007-02-08"},
  { title: "Naruto Shippuden", type: "anime", description: "Kontynuacja przygód Naruto i jego przyjaciół", image: "narutoship.jpg", genre: "Akcja, Przygodowe", episodes: 500, episodeLength: "23 min", status: "Zakończone", startDate: "2007-02-15", endDate: "2017-03-23"},
  { title: "Boruto: Naruto Next Generations", type: "anime", description: "Opowieść o synu Naruto, Boruto", image: "boruto.jpg", genre: "Akcja, Przygodowe", episodes: 293, episodeLength: "23 min", status: "Zakończone", startDate: "2017-04-05", endDate: "2023-03-26"},
  { title: "The Last of Us Part I", type: "game", description: "Przygoda Joela i Ellie w postapokaliptycznym świecie", image: "TLOU1.jpg", genre: "Akcja, Horror, Przygodowe", releaseYear: "2022", studio: "Naughty Dog", platform: "PC, PS4, PS5"},
  { title: "The Last of Us Part II", type: "game", description: "Kontynuacja historii Ellie i Joela", image: "TLOU2.jpg", genre: "Akcja, Horror, Przygodowe", releaseYear: "2020", studio: "Naughty Dog", platform: "PC, PS4, PS5"},
  { title: "Cyberpunk 2077", type: "game", description: "Futurystyczne RPG w Night City", image: "CB.jpg", genre: "RPG, Sci-Fi", releaseYear: "2020", studio: "CD Projekt Red", platform: "PC, PS4, PS5, Xbox One, Xbox Series X"},
  {title:"Grand Theft Auto III",type:"game",description:"Rewolucyjna gra akcji w otwartym świecie osadzona w Liberty City.",image:"GT3.jpg",genre:"Akcja, Open World",releaseYear:"2001",studio:"Rockstar Games",platform:"PS2, PC, Xbox"},
{title:"Grand Theft Auto IV",type:"game",description:"Historia Niko Bellica w mrocznym Liberty City.",image:"GT4.jpg",genre:"Akcja, Open World",releaseYear:"2008",studio:"Rockstar Games",platform:"PS3, Xbox 360, PC"},
{title:"Grand Theft Auto V",type:"game",description:"Trzech bohaterów, ogromny świat i tryb GTA Online.",image:"GT5.jpg",genre:"Akcja, Open World",releaseYear:"2013",studio:"Rockstar Games",platform:"PS3, PS4, PS5, Xbox, PC"},
{title:"Grand Theft Auto: San Andreas",type:"game",description:"Kultowa historia CJ-a w stanie San Andreas.",image:"GTSA.jpg",genre:"Akcja, Open World",releaseYear:"2004",studio:"Rockstar Games",platform:"PS2, PC, Xbox"},
{title:"Grand Theft Auto: Vice City",type:"game",description:"Neonowy klimat lat 80. i historia Tommy'ego Vercettiego.",image:"GTVC.jpg",genre:"Akcja, Open World",releaseYear:"2002",studio:"Rockstar Games",platform:"PS2, PC, Xbox"},
{title:"Elden Ring",type:"game",description:"Mroczne RPG akcji w ogromnym świecie fantasy.",image:"elden.jpg",genre:"RPG, Soulslike, Open World",releaseYear:"2022",studio:"FromSoftware",platform:"PS4, PS5, Xbox, PC"},
{title:"God of War",type:"game",description:"Nowy rozdział historii Kratosa w nordyckiej mitologii.",image:"GoW.jpg",genre:"Akcja, RPG",releaseYear:"2018",studio:"Santa Monica Studio",platform:"PS4, PS5, PC"},
{title:"God of War Ragnarök",type:"game",description:"Kontynuacja przygód Kratosa i Atreusa podczas Ragnaröku.",image:"GoWR.jpg",genre:"Akcja, RPG",releaseYear:"2022",studio:"Santa Monica Studio",platform:"PC, PS4, PS5"},
{ title: "Jujutsu Kaisen", type: "anime", description: "Uczeń liceum wplątany w świat klątw i egzorcystów.", image: "JJK.jpg", genre: "Shounen, Akcja, Nadprzyrodzone", episodes: 24, episodeLength: "23 min", status: "Zakończone", startDate: "2020-10-03", endDate: "2021-03-27" },
{ title: "Demon Slayer", type: "anime", description: "Tanjiro walczy z demonami, by uratować swoją siostrę.", image: "DS.jpg", genre: "Shounen, Akcja, Fantasy", episodes: 63, episodeLength: "24 min", status: "Zakończone", startDate: "2019-04-06", endDate: "2019-09-28" },
{ title: "One Piece", type: "anime", description: "Przygody Monkey D. Luffy’ego w poszukiwaniu legendarnego skarbu.", image: "op.jpg", genre: "Shounen, Przygodowe, Akcja", episodes: 1060, episodeLength: "24 min", status: "Trwa", startDate: "1999-10-20", endDate: "" },
{ title: "Tokyo Ghoul", type: "anime", description: "Mroczna historia studenta, który staje się pół-ghulem.", image: "TG.jpg", genre: "Horror, Akcja, Psychologiczne", episodes: 48, episodeLength: "24 min", status: "Zakończone", startDate: "2014-07-04", endDate: "2014-09-19" },
{title:"Clannad",type:"anime",description:"Historia Tomoyi i Nagisy, pełna emocji i wzruszeń.",image:"clannad.jpg",genre:"Drama, Romantyczne",episodes:23,episodeLength:"24 min",status:"Zakończone",startDate:"2007-10-04",endDate:"2008-03-27",studio:"Kyoto Animation"},
{title:"Clannad: After Story",type:"anime",description:"Kontynuacja przygód Tomoyi i Nagisy, historia pełna wzruszeń.",image:"clannadAS.jpg",genre:"Drama, Romantyczne",episodes:24,episodeLength:"24 min",status:"Zakończone",startDate:"2008-10-03",endDate:"2009-03-27",studio:"Kyoto Animation"}
];

const params = new URLSearchParams(window.location.search);
const titleFromURL = params.get("title");
const selectedItem = items.find(i => i.title === titleFromURL);

if(selectedItem){
  document.getElementById("title").textContent = selectedItem.title;
  document.getElementById("type").textContent = "Typ: " + selectedItem.type;
  document.getElementById("description").textContent = selectedItem.description;
  document.getElementById("cover").src = "images/" + selectedItem.image;
  const extra = document.getElementById("extraDetails");
  if(selectedItem.type==="anime"){
    extra.innerHTML=`<p><strong>Gatunek:</strong> ${selectedItem.genre}</p>
<p><strong>Odcinki:</strong> ${selectedItem.episodes}</p>
<p><strong>Czas odcinka:</strong> ${selectedItem.episodeLength}</p>
<p><strong>Status:</strong> ${selectedItem.status}</p>
<p><strong>Start emisji:</strong> ${selectedItem.startDate}</p>
<p><strong>Koniec emisji:</strong> ${selectedItem.endDate}</p>`;
  } else {
    extra.innerHTML=`<p><strong>Gatunek:</strong> ${selectedItem.genre}</p>
<p><strong>Rok wydania:</strong> ${selectedItem.releaseYear}</p>
<p><strong>Studio:</strong> ${selectedItem.studio}</p>
<p><strong>Platforma:</strong> ${selectedItem.platform}</p>`;
  }
}

const stars = document.querySelectorAll('.star');
const averageRatingElem = document.getElementById('averageRating');
const voteCountElem = document.getElementById('voteCount');

let userId = localStorage.getItem("userId");
if(!userId){ userId = Date.now().toString() + Math.floor(Math.random()*1000); localStorage.setItem("userId", userId); }

const ratingDoc = doc(db, "ratings", titleFromURL || "default");

async function createDocIfNotExists(){
  const docSnap = await getDoc(ratingDoc);
  if(!docSnap.exists()){ await setDoc(ratingDoc, {votes:0, total:0, userVoted:[]}); }
}

async function saveVote(value){
  const docSnap = await getDoc(ratingDoc);
  const data = docSnap.data();
  if(!data.userVoted.includes(userId)){
    await updateDoc(ratingDoc, {votes: increment(1), total: increment(value), userVoted: arrayUnion(userId)});
  } else {
    alert("Już zagłosowałeś!");
  }
}

function updateStars(value){
  stars.forEach(star=>{
    if(parseInt(star.dataset.value) <= value){ star.textContent = "★"; star.classList.add("filled"); }
    else { star.textContent = "☆"; star.classList.remove("filled"); }
  });
}

onSnapshot(ratingDoc, (docSnap)=>{
  if(docSnap.exists()){
    const data = docSnap.data();
    const avg = data.votes ? (data.total / data.votes).toFixed(1) : 0;
    updateStars(Math.round(avg));
    averageRatingElem.textContent = avg + " / 10";
    voteCountElem.textContent = data.votes + " głosów";
  }
});

stars.forEach(star=>{
  star.addEventListener('click', ()=>{ const value = parseInt(star.dataset.value); createDocIfNotExists().then(()=>saveVote(value)); });
  star.addEventListener('mouseover', ()=>updateStars(parseInt(star.dataset.value)));
  star.addEventListener('mouseout', async ()=>{
    const docSnap = await getDoc(ratingDoc);
    const data = docSnap.data();
    const lastValue = data.votes ? Math.round(data.total/data.votes) : 0;
    updateStars(lastValue);
  });
});
</script>

</body>
</html>
